{"ast":null,"code":"import _regeneratorRuntime from\"/home/ricardo/bankpague/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"/home/ricardo/bankpague/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"/home/ricardo/bankpague/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import React,{useCallback,useRef}from'react';import{FiMail,FiUser,FiLock,FiCamera,FiArrowLeft}from'react-icons/fi';import{Form}from'@unform/web';import{Link,useHistory}from'react-router-dom';import*as Yup from'yup';import{useToast}from\"../../hooks/ToastContext\";import{useAuth}from\"../../hooks/AuthContext\";import api from\"../../services/api\";import getValidationErrors from\"../../utils/getValidationErrors\";import Input from\"../../components/Input\";import Button from\"../../components/Button\";import{Container,Content,AvatarInput}from'./styles';var Profile=function Profile(){var _useAuth=useAuth(),user=_useAuth.user,updateUser=_useAuth.updateUser;var formRef=useRef(null);var history=useHistory();var _useToast=useToast(),addToast=_useToast.addToast;var handleSubmit=useCallback(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(data){var _formRef$current,schema,name,email,old_password,password,password_confirmation,formData,response,_formRef$current2,errors;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;(_formRef$current=formRef.current)===null||_formRef$current===void 0?void 0:_formRef$current.setErrors({});schema=Yup.object().shape({name:Yup.string().required('Nome obrigatório'),email:Yup.string().required('E-mail obrigatório').email('Digite um e-mail válido'),old_password:Yup.string(),password:Yup.string().when('old_password',{is:function is(val){return!!val.length;},then:Yup.string().required(),otherwise:Yup.string()}),password_confirmation:Yup.string().when('old_password',{is:function is(val){return!!val.length;},then:Yup.string().required(),otherwise:Yup.string()}).oneOf([Yup.ref('password'),null],'Confirmação inválida')});_context.next=5;return schema.validate(data,{abortEarly:false});case 5:name=data.name,email=data.email,old_password=data.old_password,password=data.password,password_confirmation=data.password_confirmation;formData=_objectSpread({name:name,email:email},old_password?{old_password:old_password,password:password,password_confirmation:password_confirmation}:{});_context.next=9;return api.put('/profile',formData);case 9:response=_context.sent;updateUser(response.data);history.push('/dashboard');addToast({type:'success',title:'Perfil atualizado!',description:'Suas informações do perfil foram atualizadas com sucesso!'});_context.next=22;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](0);if(!(_context.t0 instanceof Yup.ValidationError)){_context.next=21;break;}errors=getValidationErrors(_context.t0);(_formRef$current2=formRef.current)===null||_formRef$current2===void 0?void 0:_formRef$current2.setErrors(errors);return _context.abrupt(\"return\");case 21:addToast({type:'error',title:'Erro na autenticação',description:'Ocorreu um erro ao atualizar o perfil, tente novamente.'});case 22:case\"end\":return _context.stop();}}},_callee,null,[[0,15]]);}));return function(_x){return _ref.apply(this,arguments);};}(),[updateUser,history,addToast]);var handleAvatarChange=useCallback(function(e){if(e.target.files){var data=new FormData();data.append('avatar',e.target.files[0]);api.patch('/users/avatar',data).then(function(response){updateUser(response.data);addToast({type:'success',title:'Avatar atualizado!'});});}},[addToast,updateUser]);return/*#__PURE__*/React.createElement(Container,null,/*#__PURE__*/React.createElement(\"header\",null,/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Link,{to:\"/dashboard\"},/*#__PURE__*/React.createElement(FiArrowLeft,null)))),/*#__PURE__*/React.createElement(Content,null,/*#__PURE__*/React.createElement(Form,{ref:formRef,initialData:{name:user.name,email:user.email},onSubmit:handleSubmit},/*#__PURE__*/React.createElement(AvatarInput,null,/*#__PURE__*/React.createElement(\"img\",{src:user.avatar_url,alt:user.name}),/*#__PURE__*/React.createElement(\"label\",{htmlFor:\"avatar\"},/*#__PURE__*/React.createElement(FiCamera,null),/*#__PURE__*/React.createElement(\"input\",{type:\"file\",id:\"avatar\",onChange:handleAvatarChange}))),/*#__PURE__*/React.createElement(\"h1\",null,\"Meu perfil\"),/*#__PURE__*/React.createElement(Input,{name:\"name\",placeholder:\"Nome\",icon:FiUser}),/*#__PURE__*/React.createElement(Input,{name:\"email\",type:\"email\",placeholder:\"E-mail\",icon:FiMail}),/*#__PURE__*/React.createElement(Input,{containerStyle:{marginTop:24},name:\"old_password\",type:\"password\",placeholder:\"Senha Atual\",icon:FiLock}),/*#__PURE__*/React.createElement(Input,{name:\"password\",type:\"password\",placeholder:\"Nova Senha\",icon:FiLock}),/*#__PURE__*/React.createElement(Input,{name:\"password_confirmation\",type:\"password\",placeholder:\"Confirmar Senha\",icon:FiLock}),/*#__PURE__*/React.createElement(Button,{type:\"submit\"},\"Confirmar Mudan\\xE7as\"))));};export default Profile;","map":{"version":3,"sources":["/home/ricardo/bankpague/front/src/pages/Profile/index.tsx"],"names":["React","useCallback","useRef","FiMail","FiUser","FiLock","FiCamera","FiArrowLeft","Form","Link","useHistory","Yup","useToast","useAuth","api","getValidationErrors","Input","Button","Container","Content","AvatarInput","Profile","user","updateUser","formRef","history","addToast","handleSubmit","data","current","setErrors","schema","object","shape","name","string","required","email","old_password","password","when","is","val","length","then","otherwise","password_confirmation","oneOf","ref","validate","abortEarly","formData","put","response","push","type","title","description","ValidationError","errors","handleAvatarChange","e","target","files","FormData","append","patch","avatar_url","marginTop"],"mappings":"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","sourcesContent":["import React, { useCallback, useRef, ChangeEvent } from 'react';\nimport { FiMail, FiUser, FiLock, FiCamera, FiArrowLeft } from 'react-icons/fi';\nimport { FormHandles } from '@unform/core';\nimport { Form } from '@unform/web';\nimport { Link, useHistory } from 'react-router-dom';\n\nimport * as Yup from 'yup';\n\nimport { useToast } from '~/hooks/ToastContext';\nimport { useAuth } from '~/hooks/AuthContext';\n\nimport api from '~/services/api';\nimport getValidationErrors from '~/utils/getValidationErrors';\n\nimport Input from '~/components/Input';\nimport Button from '~/components/Button';\n\nimport IProfileFormData from './interfaces/IProfileFormData';\n\nimport { Container, Content, AvatarInput } from './styles';\n\nconst Profile: React.FC = () => {\n  const { user, updateUser } = useAuth();\n\n  const formRef = useRef<FormHandles>(null);\n  const history = useHistory();\n\n  const { addToast } = useToast();\n\n  const handleSubmit = useCallback(\n    async (data: IProfileFormData) => {\n      try {\n        formRef.current?.setErrors({});\n\n        const schema = Yup.object().shape({\n          name: Yup.string().required('Nome obrigatório'),\n          email: Yup.string()\n            .required('E-mail obrigatório')\n            .email('Digite um e-mail válido'),\n          old_password: Yup.string(),\n          password: Yup.string().when('old_password', {\n            is: val => !!val.length,\n            then: Yup.string().required(),\n            otherwise: Yup.string(),\n          }),\n          password_confirmation: Yup.string()\n            .when('old_password', {\n              is: val => !!val.length,\n              then: Yup.string().required(),\n              otherwise: Yup.string(),\n            })\n            .oneOf([Yup.ref('password'), null], 'Confirmação inválida'),\n        });\n\n        await schema.validate(data, {\n          abortEarly: false,\n        });\n\n        const {\n          name,\n          email,\n          old_password,\n          password,\n          password_confirmation,\n        } = data;\n\n        const formData = {\n          name,\n          email,\n          ...(old_password\n            ? {\n                old_password,\n                password,\n                password_confirmation,\n              }\n            : {}),\n        };\n\n        const response = await api.put('/profile', formData);\n\n        updateUser(response.data);\n\n        history.push('/dashboard');\n\n        addToast({\n          type: 'success',\n          title: 'Perfil atualizado!',\n          description:\n            'Suas informações do perfil foram atualizadas com sucesso!',\n        });\n      } catch (err) {\n        if (err instanceof Yup.ValidationError) {\n          const errors = getValidationErrors(err);\n\n          formRef.current?.setErrors(errors);\n\n          return;\n        }\n\n        addToast({\n          type: 'error',\n          title: 'Erro na autenticação',\n          description:\n            'Ocorreu um erro ao atualizar o perfil, tente novamente.',\n        });\n      }\n    },\n    [updateUser, history, addToast],\n  );\n\n  const handleAvatarChange = useCallback(\n    (e: ChangeEvent<HTMLInputElement>) => {\n      if (e.target.files) {\n        const data = new FormData();\n\n        data.append('avatar', e.target.files[0]);\n\n        api.patch('/users/avatar', data).then(response => {\n          updateUser(response.data);\n\n          addToast({\n            type: 'success',\n            title: 'Avatar atualizado!',\n          });\n        });\n      }\n    },\n    [addToast, updateUser],\n  );\n\n  return (\n    <Container>\n      <header>\n        <div>\n          <Link to=\"/dashboard\">\n            <FiArrowLeft />\n          </Link>\n        </div>\n      </header>\n\n      <Content>\n        <Form\n          ref={formRef}\n          initialData={{\n            name: user.name,\n            email: user.email,\n          }}\n          onSubmit={handleSubmit}\n        >\n          <AvatarInput>\n            <img src={user.avatar_url} alt={user.name} />\n            <label htmlFor=\"avatar\">\n              <FiCamera />\n\n              <input type=\"file\" id=\"avatar\" onChange={handleAvatarChange} />\n            </label>\n          </AvatarInput>\n\n          <h1>Meu perfil</h1>\n\n          <Input name=\"name\" placeholder=\"Nome\" icon={FiUser} />\n          <Input name=\"email\" type=\"email\" placeholder=\"E-mail\" icon={FiMail} />\n\n          <Input\n            containerStyle={{ marginTop: 24 }}\n            name=\"old_password\"\n            type=\"password\"\n            placeholder=\"Senha Atual\"\n            icon={FiLock}\n          />\n          <Input\n            name=\"password\"\n            type=\"password\"\n            placeholder=\"Nova Senha\"\n            icon={FiLock}\n          />\n          <Input\n            name=\"password_confirmation\"\n            type=\"password\"\n            placeholder=\"Confirmar Senha\"\n            icon={FiLock}\n          />\n\n          <Button type=\"submit\">Confirmar Mudanças</Button>\n        </Form>\n      </Content>\n    </Container>\n  );\n};\n\nexport default Profile;\n"]},"metadata":{},"sourceType":"module"}