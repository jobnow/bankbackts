{"ast":null,"code":"import _regeneratorRuntime from\"/home/ricardo/bankpague/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/ricardo/bankpague/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/ricardo/bankpague/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{createContext,useCallback,useState,useContext}from'react';import api from\"../services/api\";var AuthContext=createContext({});var AuthProvider=function AuthProvider(_ref){var children=_ref.children;var _useState=useState(function(){var token=localStorage.getItem('@GoBarber:token');var user=localStorage.getItem('@GoBarber:user');if(token&&user){api.defaults.headers.authorization=\"Bearer \".concat(token);return{token:token,user:JSON.parse(user)};}return{};}),_useState2=_slicedToArray(_useState,2),data=_useState2[0],setData=_useState2[1];var signIn=useCallback(/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref2){var email,password,response,_response$data,token,user;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:email=_ref2.email,password=_ref2.password;_context.next=3;return api.post('sessions',{email:email,password:password});case 3:response=_context.sent;_response$data=response.data,token=_response$data.token,user=_response$data.user;localStorage.setItem('@GoBarber:token',token);localStorage.setItem('@GoBarber:user',JSON.stringify(user));api.defaults.headers.authorization=\"Bearer \".concat(token);setData({token:token,user:user});case 9:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref3.apply(this,arguments);};}(),[]);var signOut=useCallback(function(){localStorage.removeItem('@GoBarber:token');localStorage.removeItem('@GoBarber:user');setData({});},[]);var updateUser=useCallback(function(user){localStorage.setItem('@GoBarber:user',JSON.stringify(user));setData({token:data.token,user:user});},[data.token]);return/*#__PURE__*/React.createElement(AuthContext.Provider,{value:{user:data.user,signIn:signIn,signOut:signOut,updateUser:updateUser}},children);};function useAuth(){var context=useContext(AuthContext);return context;}export{AuthProvider,useAuth};","map":{"version":3,"sources":["/home/ricardo/bankpague/front/src/hooks/AuthContext.tsx"],"names":["React","createContext","useCallback","useState","useContext","api","AuthContext","AuthProvider","children","token","localStorage","getItem","user","defaults","headers","authorization","JSON","parse","data","setData","signIn","email","password","post","response","setItem","stringify","signOut","removeItem","updateUser","useAuth","context"],"mappings":"ybAAA,MAAOA,CAAAA,KAAP,EAAgBC,aAAhB,CAA+BC,WAA/B,CAA4CC,QAA5C,CAAsDC,UAAtD,KAAwE,OAAxE,CACA,MAAOC,CAAAA,GAAP,KAAgB,iBAAhB,CA0BA,GAAMC,CAAAA,WAAW,CAAGL,aAAa,CAAmB,EAAnB,CAAjC,CAEA,GAAMM,CAAAA,YAAsB,CAAG,QAAzBA,CAAAA,YAAyB,MAAkB,IAAfC,CAAAA,QAAe,MAAfA,QAAe,eACvBL,QAAQ,CAAa,UAAM,CACjD,GAAMM,CAAAA,KAAK,CAAGC,YAAY,CAACC,OAAb,CAAqB,iBAArB,CAAd,CACA,GAAMC,CAAAA,IAAI,CAAGF,YAAY,CAACC,OAAb,CAAqB,gBAArB,CAAb,CAEA,GAAIF,KAAK,EAAIG,IAAb,CAAmB,CACjBP,GAAG,CAACQ,QAAJ,CAAaC,OAAb,CAAqBC,aAArB,kBAA+CN,KAA/C,EAEA,MAAO,CAAEA,KAAK,CAALA,KAAF,CAASG,IAAI,CAAEI,IAAI,CAACC,KAAL,CAAWL,IAAX,CAAf,CAAP,CACD,CAED,MAAO,EAAP,CACD,CAX+B,CADe,wCACxCM,IADwC,eAClCC,OADkC,eAc/C,GAAMC,CAAAA,MAAM,CAAGlB,WAAW,2FAAC,8LAASmB,KAAT,OAASA,KAAT,CAAgBC,QAAhB,OAAgBA,QAAhB,uBACFjB,CAAAA,GAAG,CAACkB,IAAJ,CAAS,UAAT,CAAqB,CAC1CF,KAAK,CAALA,KAD0C,CAE1CC,QAAQ,CAARA,QAF0C,CAArB,CADE,QACnBE,QADmB,8BAMDA,QAAQ,CAACN,IANR,CAMjBT,KANiB,gBAMjBA,KANiB,CAMVG,IANU,gBAMVA,IANU,CAQzBF,YAAY,CAACe,OAAb,CAAqB,iBAArB,CAAwChB,KAAxC,EACAC,YAAY,CAACe,OAAb,CAAqB,gBAArB,CAAuCT,IAAI,CAACU,SAAL,CAAed,IAAf,CAAvC,EAEAP,GAAG,CAACQ,QAAJ,CAAaC,OAAb,CAAqBC,aAArB,kBAA+CN,KAA/C,EAEAU,OAAO,CAAC,CAAEV,KAAK,CAALA,KAAF,CAASG,IAAI,CAAJA,IAAT,CAAD,CAAP,CAbyB,sDAAD,gEAcvB,EAduB,CAA1B,CAgBA,GAAMe,CAAAA,OAAO,CAAGzB,WAAW,CAAC,UAAM,CAChCQ,YAAY,CAACkB,UAAb,CAAwB,iBAAxB,EACAlB,YAAY,CAACkB,UAAb,CAAwB,gBAAxB,EAEAT,OAAO,CAAC,EAAD,CAAP,CACD,CAL0B,CAKxB,EALwB,CAA3B,CAOA,GAAMU,CAAAA,UAAU,CAAG3B,WAAW,CAC5B,SAACU,IAAD,CAAiB,CACfF,YAAY,CAACe,OAAb,CAAqB,gBAArB,CAAuCT,IAAI,CAACU,SAAL,CAAed,IAAf,CAAvC,EAEAO,OAAO,CAAC,CACNV,KAAK,CAAES,IAAI,CAACT,KADN,CAENG,IAAI,CAAJA,IAFM,CAAD,CAAP,CAID,CAR2B,CAS5B,CAACM,IAAI,CAACT,KAAN,CAT4B,CAA9B,CAYA,mBACE,oBAAC,WAAD,CAAa,QAAb,EACE,KAAK,CAAE,CAAEG,IAAI,CAAEM,IAAI,CAACN,IAAb,CAAmBQ,MAAM,CAANA,MAAnB,CAA2BO,OAAO,CAAPA,OAA3B,CAAoCE,UAAU,CAAVA,UAApC,CADT,EAGGrB,QAHH,CADF,CAOD,CAxDD,CA0DA,QAASsB,CAAAA,OAAT,EAAqC,CACnC,GAAMC,CAAAA,OAAO,CAAG3B,UAAU,CAACE,WAAD,CAA1B,CAEA,MAAOyB,CAAAA,OAAP,CACD,CAED,OAASxB,YAAT,CAAuBuB,OAAvB","sourcesContent":["import React, { createContext, useCallback, useState, useContext } from 'react';\nimport api from '~/services/api';\n\ninterface IUser {\n  id: string;\n  name: string;\n  email: string;\n  avatar_url: string;\n}\n\ninterface IAuthState {\n  token: string;\n  user: IUser;\n}\n\ninterface ISignInCredentials {\n  email: string;\n  password: string;\n}\n\ninterface IAuthContextData {\n  user: IUser;\n  signIn(credentials: ISignInCredentials): Promise<void>;\n  signOut(): void;\n  updateUser(user: IUser): void;\n}\n\nconst AuthContext = createContext<IAuthContextData>({} as IAuthContextData);\n\nconst AuthProvider: React.FC = ({ children }) => {\n  const [data, setData] = useState<IAuthState>(() => {\n    const token = localStorage.getItem('@GoBarber:token');\n    const user = localStorage.getItem('@GoBarber:user');\n\n    if (token && user) {\n      api.defaults.headers.authorization = `Bearer ${token}`;\n\n      return { token, user: JSON.parse(user) };\n    }\n\n    return {} as IAuthState;\n  });\n\n  const signIn = useCallback(async ({ email, password }) => {\n    const response = await api.post('sessions', {\n      email,\n      password,\n    });\n\n    const { token, user } = response.data;\n\n    localStorage.setItem('@GoBarber:token', token);\n    localStorage.setItem('@GoBarber:user', JSON.stringify(user));\n\n    api.defaults.headers.authorization = `Bearer ${token}`;\n\n    setData({ token, user });\n  }, []);\n\n  const signOut = useCallback(() => {\n    localStorage.removeItem('@GoBarber:token');\n    localStorage.removeItem('@GoBarber:user');\n\n    setData({} as IAuthState);\n  }, []);\n\n  const updateUser = useCallback(\n    (user: IUser) => {\n      localStorage.setItem('@GoBarber:user', JSON.stringify(user));\n\n      setData({\n        token: data.token,\n        user,\n      });\n    },\n    [data.token],\n  );\n\n  return (\n    <AuthContext.Provider\n      value={{ user: data.user, signIn, signOut, updateUser }}\n    >\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nfunction useAuth(): IAuthContextData {\n  const context = useContext(AuthContext);\n\n  return context;\n}\n\nexport { AuthProvider, useAuth };\n"]},"metadata":{},"sourceType":"module"}