{"ast":null,"code":"import _regeneratorRuntime from\"/home/ricardo/bankpague/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/ricardo/bankpague/front/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import React,{useRef,useCallback}from'react';import{FiLock}from'react-icons/fi';import{Form}from'@unform/web';import{useHistory,useLocation}from'react-router-dom';import*as Yup from'yup';import getValidationErrors from\"../../utils/getValidationErrors\";import api from\"../../services/api\";import{useToast}from\"../../hooks/ToastContext\";import Input from\"../../components/Input\";import Button from\"../../components/Button\";import logoImg from\"../../assets/logo.svg\";import{Container,Content,AnimationContainer,Background}from'./styles';var ResetPassword=function ResetPassword(){var formRef=useRef(null);var history=useHistory();var location=useLocation();var _useToast=useToast(),addToast=_useToast.addToast;var handleSubmit=useCallback(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(data){var _formRef$current,password,password_confirmation,token,schema,_formRef$current2,errors;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;password=data.password,password_confirmation=data.password_confirmation;token=location.search.replace('?token=','');if(token){_context.next=5;break;}throw new Error();case 5:(_formRef$current=formRef.current)===null||_formRef$current===void 0?void 0:_formRef$current.setErrors({});schema=Yup.object().shape({password:Yup.string().required('Senha obrigatória'),password_confirmation:Yup.string().oneOf([Yup.ref('password'),null],'Confirmação inválida')});_context.next=9;return schema.validate(data,{abortEarly:false});case 9:_context.next=11;return api.post('/password/reset',{password:password,password_confirmation:password_confirmation,token:token});case 11:history.push('/');_context.next=21;break;case 14:_context.prev=14;_context.t0=_context[\"catch\"](0);if(!(_context.t0 instanceof Yup.ValidationError)){_context.next=20;break;}errors=getValidationErrors(_context.t0);(_formRef$current2=formRef.current)===null||_formRef$current2===void 0?void 0:_formRef$current2.setErrors(errors);return _context.abrupt(\"return\");case 20:addToast({type:'error',title:'Erro ao resetar senha',description:'Ocorreu um erro ao resetar a sua senha, tente novamente.'});case 21:case\"end\":return _context.stop();}}},_callee,null,[[0,14]]);}));return function(_x){return _ref.apply(this,arguments);};}(),[location.search,history,addToast]);return/*#__PURE__*/React.createElement(Container,null,/*#__PURE__*/React.createElement(Content,null,/*#__PURE__*/React.createElement(AnimationContainer,null,/*#__PURE__*/React.createElement(\"img\",{src:logoImg,alt:\"Go Barber\"}),/*#__PURE__*/React.createElement(Form,{ref:formRef,onSubmit:handleSubmit},/*#__PURE__*/React.createElement(\"h1\",null,\"Resetar Senha\"),/*#__PURE__*/React.createElement(Input,{name:\"password\",type:\"password\",placeholder:\"Informe a Nova Senha\",icon:FiLock}),/*#__PURE__*/React.createElement(Input,{name:\"password_confirmation\",type:\"password\",placeholder:\"Confirma\\xE7\\xE3o da Nova Senha\",icon:FiLock}),/*#__PURE__*/React.createElement(Button,{type:\"submit\"},\"Alterar Senha\")))),/*#__PURE__*/React.createElement(Background,null));};export default ResetPassword;","map":{"version":3,"sources":["/home/ricardo/bankpague/front/src/pages/ResetPassword/index.tsx"],"names":["React","useRef","useCallback","FiLock","Form","useHistory","useLocation","Yup","getValidationErrors","api","useToast","Input","Button","Container","Content","AnimationContainer","Background","ResetPassword","formRef","history","location","addToast","handleSubmit","data","password","password_confirmation","token","search","replace","Error","current","setErrors","schema","object","shape","string","required","oneOf","ref","validate","abortEarly","post","push","ValidationError","errors","type","title","description","logoImg"],"mappings":"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","sourcesContent":["import React, { useRef, useCallback } from 'react';\nimport { FiLock } from 'react-icons/fi';\nimport { FormHandles } from '@unform/core';\nimport { Form } from '@unform/web';\nimport { useHistory, useLocation } from 'react-router-dom';\n\nimport * as Yup from 'yup';\nimport getValidationErrors from '~/utils/getValidationErrors';\n\nimport api from '~/services/api';\n\nimport { useToast } from '~/hooks/ToastContext';\n\nimport IResetPasswordFormData from './interfaces/IResetPasswordFormData';\n\nimport Input from '~/components/Input';\nimport Button from '~/components/Button';\n\nimport logoImg from '~/assets/logo.svg';\n\nimport { Container, Content, AnimationContainer, Background } from './styles';\n\nconst ResetPassword: React.FC = () => {\n  const formRef = useRef<FormHandles>(null);\n  const history = useHistory();\n  const location = useLocation();\n\n  const { addToast } = useToast();\n\n  const handleSubmit = useCallback(\n    async (data: IResetPasswordFormData) => {\n      try {\n        const { password, password_confirmation } = data;\n        const token = location.search.replace('?token=', '');\n\n        if (!token) {\n          throw new Error();\n        }\n\n        formRef.current?.setErrors({});\n\n        const schema = Yup.object().shape({\n          password: Yup.string().required('Senha obrigatória'),\n          password_confirmation: Yup.string().oneOf(\n            [Yup.ref('password'), null],\n            'Confirmação inválida',\n          ),\n        });\n\n        await schema.validate(data, {\n          abortEarly: false,\n        });\n\n        await api.post('/password/reset', {\n          password,\n          password_confirmation,\n          token,\n        });\n\n        history.push('/');\n      } catch (err) {\n        if (err instanceof Yup.ValidationError) {\n          const errors = getValidationErrors(err);\n\n          formRef.current?.setErrors(errors);\n\n          return;\n        }\n\n        addToast({\n          type: 'error',\n          title: 'Erro ao resetar senha',\n          description:\n            'Ocorreu um erro ao resetar a sua senha, tente novamente.',\n        });\n      }\n    },\n    [location.search, history, addToast],\n  );\n\n  return (\n    <Container>\n      <Content>\n        <AnimationContainer>\n          <img src={logoImg} alt=\"Go Barber\" />\n\n          <Form ref={formRef} onSubmit={handleSubmit}>\n            <h1>Resetar Senha</h1>\n\n            <Input\n              name=\"password\"\n              type=\"password\"\n              placeholder=\"Informe a Nova Senha\"\n              icon={FiLock}\n            />\n\n            <Input\n              name=\"password_confirmation\"\n              type=\"password\"\n              placeholder=\"Confirmação da Nova Senha\"\n              icon={FiLock}\n            />\n\n            <Button type=\"submit\">Alterar Senha</Button>\n          </Form>\n        </AnimationContainer>\n      </Content>\n      <Background />\n    </Container>\n  );\n};\n\nexport default ResetPassword;\n"]},"metadata":{},"sourceType":"module"}